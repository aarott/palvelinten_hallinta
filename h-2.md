# h-2 Karjaa  

## x)  

Slater 2017: [What is the definition of "cattle not pets"?](https://devops.stackexchange.com/questions/653/what-is-the-definition-of-cattle-not-pets#654). (Vain tuo yksi vastaus DevOps Stack Exchangen kysymykseen)

- Petsit on servereitä jotka ei saa koskaan olla “down” eli pois käytöstä, esim palomuurit, tietojärjestelmät jne  
- Petsit on manuaalisti  “käsin” rakennettejua servereitä  
- Cattle on kokoelma useampia servereitä jotka on automaattisesti hallittuja. Esim Weppipalvelimet ovat tällaisia, eivät tarvitse ihmisen interventiota  esim uudelleenkäynnistämiseen

Karvinen 2017: [Vagrant Revisited – Install & Boot New Virtual Machine in 31 seconds](https://terokarvinen.com/2017/04/11/vagrant-revisited-install-boot-new-virtual-machine-in-31-seconds/) (Suosittelen koneeksi 'vagrant init debian/bullseye64')

- Vagrantilla voidaan hyvin lyhyessä ajassa käynnistä uusii virtuaalinen kone jota hallita ssh-yhteydellä
- sudo apt-get -y install vagrant virtualbox
- vagrant init bento/ubuntu-16.04
- vagrant up
- vagrant ssh

Karvinen 2023: [Salt Vagrant - automatically provision one master and two slaves](https://terokarvinen.com/2023/salt-vagrant/)

- Vagrant Virtualisointi ympäristön asentaminen 
- Ohjeet laadittu sivulla linuxille
- Valmis Vagrant-tiedosto kolmen koneen luomiseen
- Kolmen koneen ajaminen
- Orjien ottaminen vastaan ja hallinta masterkoneelta
- Tavoite idempotenttisuus
- Koodi tiedostoilla voidaan ohjelmoida haluttu sallittu tila

## a) Asenna Vagrant  

Koska en ollut kotikoneella, päätin aloittaa tehtävän Macbook Air 6,2 läppärillä.  

Asensin Homebrewn:n paketinhallintaa varten https://brew.sh  

Macin terminaaliin:  

$ /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"  

$ brew install --cask vagrant  

![Screen Shot 2023-11-05 at 12 47 02](https://github.com/aarott/palvelinten_hallinta/assets/78908566/ae5e1312-3015-4114-8a87-efd0e3c538d0)  

$ vagrant init bento/ubuntu-16.04  

$ vagrant up  

![Screen Shot 2023-11-05 at 13 01 42](https://github.com/aarott/palvelinten_hallinta/assets/78908566/9a0c0891-5bdc-4b38-8df5-26f8e5f696ef)  

VirtualBoxiin ilmestyi nyt uusi virtuaalinen kone:   

![Screen Shot 2023-11-05 at 13 03 12](https://github.com/aarott/palvelinten_hallinta/assets/78908566/93f61c42-6295-4567-9e21-582bdc3bb1ad)  

## b) SSH-yhteys 

$ vagrant ssh  

![Screen Shot 2023-11-05 at 13 07 12](https://github.com/aarott/palvelinten_hallinta/assets/78908566/31b452c9-c251-44a4-a571-5a90f4f66022)  

Testasin netin toimivuuden pingaamalla Teron sivua, näyttäisi toimivan.  

![Screen Shot 2023-11-05 at 13 21 39](https://github.com/aarott/palvelinten_hallinta/assets/78908566/37b0c56e-4157-4498-9df1-7213d147d15d)

## c) Asenna Salt-herra ja orja samalle koneelle  

Avasin DebianX virutaalikoneen VirtualBoxista.  

Asensin päivitykset:  

$ sudo apt-get update
$ sudo apt-get upgrade  

Käytin tässä tehtävssä Teron ohjetta:  

https://terokarvinen.com/2018/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/  

Salt-masterin asennus:  

$ sudo apt-get install -y salt-master  

![Screen Shot 2023-11-05 at 13 59 24](https://github.com/aarott/palvelinten_hallinta/assets/78908566/6a94ae5c-4cda-44cf-b7b3-5edd34fdf0b0)  

Pakettia asennukseen ei löytynytkään, kävin tarkistamassa sitten [Salt Project - Install guide](https://docs.saltproject.io/salt/install-guide/en/latest/topics/install-by-operating-system/debian.html) sivustolta miten asennus tapahtuu.  

$ mkdir /etc/apt/keyrings

$ sudo curl -fsSL -o /etc/apt/keyrings/salt-archive-keyring-2023.gpg https://repo.saltproject.io/salt/py3/debian/11/amd64/SALT-PROJECT-GPG-PUBKEY-2023.gpg
echo "deb [signed-by=/etc/apt/keyrings/salt-archive-keyring-2023.gpg arch=amd64] https://repo.saltproject.io/salt/py3/debian/11/amd64/latest bullseye main" | sudo tee /etc/apt/sources.list.d/salt.list  

$ sudo apt-get update  

Tämän jälkeen salt-master lähti asentumaan:  

![Screen Shot 2023-11-05 at 14 12 36](https://github.com/aarott/palvelinten_hallinta/assets/78908566/25a9b4dc-78e1-4a73-b38e-09084626bff6)  

Kävin avaamassa portit 4505 ja 4506 palomuurista salt-masteria varten.  

$ sudo ufw allow 4505
$ sudo ufw allow 4506 

Sen jälkeen käynnistin salt-masterin ja katsoin hostnamen:  

$ sudo systemctl enable salt-master && sudo systemctl start salt-master  
$ hostname -I  

![Screen Shot 2023-11-05 at 14 27 28](https://github.com/aarott/palvelinten_hallinta/assets/78908566/15bc1eaa-6fe0-4355-abf9-a9bc5e07578c)

##

Asennetaan salt-minion:  

$ sudo apt-get -y install salt-minion

$ sudoedit /etc/salt/minion

Muokkasin tiedostoa ja laitoin masterin hostname osoitteen ja id.  

![Screen Shot 2023-11-05 at 14 33 32](https://github.com/aarott/palvelinten_hallinta/assets/78908566/9ca360ab-e836-4709-8b16-5fda112d6fa3)  

Sitten ajoin alla olevat loput komennot salt-minion uudelleenkäynnistämiseksi ja menin masterilla hyväksymään minionin avaimen ja testasin että komentaminen toimii nyt masterin ja slaven välillä.   

![Screen Shot 2023-11-05 at 14 36 10](https://github.com/aarott/palvelinten_hallinta/assets/78908566/a59ddcbe-8bbe-4cc7-837d-ea2d39f6b3da)

## d) Salt-Herra arkkitehtuuri verkossa paikallisten koneiden välille  

Koneeseen mikä asennettiin Vagrantilla menin ssh-yhteydellä asentemaan Salt-Minonin ja sen jälkeen ottamaan DebianX koneella hyväksymään "slave-keyn". 

SSH yhteydellä oleva orja1 kone: 

sudo apt-get update
sudo apt-get install salt-minion  
sudoedit /etc/salt/minion  
sudo systemctl restart salt-minion.service

Tähän laitettiin tiedot masterista:
master: 10.2.0.15  
id: orja1  

![Screen Shot 2023-11-05 at 17 38 19](https://github.com/aarott/palvelinten_hallinta/assets/78908566/b1f06bf2-216b-4a3f-8797-fafbac5bcddf)












  
