# h-7 Oma Moduuli 

Kone millä tein Moduulin:

AMD Ryzen 2600X Six-Core Processor 3.6 ghz

16gb RAM

Windows 10 Pro 64-bit käyttöjärjestelmä

Oracle VM VirtualBox Manager

##

Tehtävä löytyy sivulta: https://terokarvinen.com/2023/configuration-management-2023-autumn/

##

Tarkoitus tässä yksinkertaisessa moduulissa on: 
  
- asentaa UFW palomuuri ja avata portit 22/80/443
  
Muutama pentest (tunkeutumistestaustyökalu): 

- Nmap (porttiskanneri)
- MitMproxy (välimiesproxy)
- Netcat (verkkotyökalu mikä vastaanottaa ja lähettää tietoa)

Asennan työkalut ensiksi Masterille käsin, sen jälkeen Saltilla orjalle.  
  

##

Käytin https://terokarvinen.com/2023/salt-vagrant/#ready-made-vagrantfile-for-three-computers artikkelin Teron koodia luomaan uuden Master koneen ja Orja koneen Vagrantilla.  
Muokkasin koneiden määrää, yhteen Master koneeseen ja yhteen Minioniin (orja).   

Windows Powershellissä ajoin komennon:  

`Vagrant init` 

Muokkasin Vagrantfile näyttämään tältä: 

![image](https://github.com/aarott/palvelinten_hallinta/assets/78908566/6b6e3f09-3630-41f2-8a6a-fdedeb39908d)    

##  

`vagrant up` --> Vagrant rupesi luomaan Virtuaalikoneita.  Koneiden luonti onnistui VirtualBoxiin:  

##  

![image](https://github.com/aarott/palvelinten_hallinta/assets/78908566/43cfafcb-d40a-4dbf-b991-d9b46bf576a2)

##

Otin SSH yhteyden Master-koneeseen ja kävin hyväksymässä orjan avaimen:  

`vagrant ssh master`  
`sudo salt-key -A` 

##  

![image](https://github.com/aarott/palvelinten_hallinta/assets/78908566/5408efb5-1f77-4922-a0b7-64bc9d51ce70)  

##  

Asensin palomuurin ja avasin portin 22, että SSH yhteys toimii.  

`$sudo apt-get update` 

`$sudo apt-get install -y ufw` 

##  

![image](https://github.com/aarott/palvelinten_hallinta/assets/78908566/e8b48047-e460-4485-8f7d-91d4515cf607)  

##  

`$sudo ufw allow 22` 

`$sudo ufw enable` 

`$sudo ufw status`  

##  

![image](https://github.com/aarott/palvelinten_hallinta/assets/78908566/96fedc54-f1ba-43ae-8816-ab32d15202a1)  

##  

Nyt kun tämä on tehty käsin, olisi tarokoitus siirtää tiedostot mitkä sisältää Ufw asennuksen säännöt /srv/salt kansioon.

Pitää siis luoda tuo /srv/salt kansio ja sen alle /ufw.  

`$sudo mkdir /srv/salt/ufw`  

## 

Tässä kohtaa mulla tuli pieni ongelma kun muistin testata varmuuden vuoksi:

`$ sudo salt '*' test.ping` 

##  

![image](https://github.com/aarott/palvelinten_hallinta/assets/78908566/377fb174-6d68-4341-822c-df1623c4a377)  

##

Ei tosiaan toiminut ja syyksi paljastui, kuten arvelinkin Master koneen UFW palomuuri. En ymmärrä miksi koska portti 22 on auki.  
Otin kuitenkin palomuurin pois päältä ja jatkoin asentamista.  

`$ sudo ufw disable` 
`$ sudo salt '*' test.ping` 

##

![image](https://github.com/aarott/palvelinten_hallinta/assets/78908566/adbd8151-bbdf-4389-9a64-f79b25028216)  

##  

Menin tässä välissä luomaan srv/salt/project kansion minkä alle tulee kaikki Saltin olennaiset tiedostot.  Tein sinne /ufw kansion palomuuria varten. 

Siirryin sitten etc/ufw kansioon mistä pitää kopioida user.rules ja user6.rules tiedostot, jotka määrittää palomuurin konfiguraatiot.  
  
`$ sudo mkdir /srv/salt/project/ufw`

`$ sudo cp user.rules user6.rules /srv/salt/project/ufw`  

##  

![image](https://github.com/aarott/palvelinten_hallinta/assets/78908566/63e4a6c8-633f-43d0-bb99-e976f3c3a1d9)  

##  

Sen jälkeen loin /srv/salt/project/ufw kansioon tiedoston init.sls:  

`$ sudo nano init.sls`  

##  

![image](https://github.com/aarott/palvelinten_hallinta/assets/78908566/ddb36b5b-dd44-45b2-b58b-b3563b031c24)  

## 

Kokeilin tässä välissä mutta ei toimi... palaan tähän myöhemmin ja koitan asentaa muut ohjelmat Saltilla välissä:

##

![image](https://github.com/aarott/palvelinten_hallinta/assets/78908566/44b9466e-b5ed-4ade-9678-d42bef963099)  

##  

Asensin Nmapin, MitMproxyn ja Netcatin Master-koneelle:  

`$ sudo apt-get install -y nmap mitmproxy netcat` 

##  

![image](https://github.com/aarott/palvelinten_hallinta/assets/78908566/512b37dc-1d1c-4012-af51-90c10f48ff0e)  

##  

`$ cd /srv/salt/project`  
`$ sudo mkdir nmap netcat mitmproxy` 

Jokaiseen kansioon loin init.sls tiedoston mihin kuului: 

`nmap:  
  pkg.installed` 













